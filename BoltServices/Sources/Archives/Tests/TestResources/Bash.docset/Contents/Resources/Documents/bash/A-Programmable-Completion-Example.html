<!DOCTYPE html>
<html>
<!-- Created by GNU Texinfo 7.2, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This text is a brief description of the features that are present in
the Bash shell (version 5.3, 18 May 2025).

This is Edition 5.3, last updated 18 May 2025,
of The GNU Bash Reference Manual,
for Bash, Version 5.3.

Copyright Â© 1988-2025 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled
"GNU Free Documentation License". -->
<title>A Programmable Completion Example</title>

<meta name="description" content="A Programmable Completion Example (Bash Reference Manual)">
<meta name="keywords" content="A Programmable Completion Example (Bash Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Indexes.html" rel="index" title="Indexes">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Command-Line-Editing.html" rel="up" title="Command Line Editing">
<link href="Programmable-Completion-Builtins.html" rel="prev" title="Programmable Completion Builtins">
<style type="text/css">
<!--
a.copiable-link {visibility: hidden; text-decoration: none; line-height: 0em}
div.example {margin-left: 3.2em}
span:hover a.copiable-link {visibility: visible}
-->
</style>
<link rel="stylesheet" type="text/css" href="">


</head>

<body lang="en">
<div class="section-level-extent" id="A-Programmable-Completion-Example">
<div class="nav-panel">
<p>
Previous: <a href="Programmable-Completion-Builtins.html" accesskey="p" rel="prev">Programmable Completion Builtins</a>, Up: <a href="Command-Line-Editing.html" accesskey="u" rel="up">Command Line Editing</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Indexes.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<h3 class="section" id="A-Programmable-Completion-Example-1"><span>8.8 A Programmable Completion Example<a class="copiable-link" href="#A-Programmable-Completion-Example-1"> &para;</a></span></h3>

<p>The most common way to obtain additional completion functionality beyond
the default actions <code class="code">complete</code> and <code class="code">compgen</code> provide is to use
a shell function and bind it to a particular command using <code class="code">complete -F</code>.
</p>
<p>The following function provides completions for the <code class="code">cd</code> builtin.
It is a reasonably good example of what shell functions must do when
used for completion.
This function uses the word passed as <code class="code">$2</code> to determine the
directory name to complete.
You can also use the
<code class="code">COMP_WORDS</code> array variable; the current word is indexed by the
<code class="code">COMP_CWORD</code> variable.
</p>
<p>The function relies on the <code class="code">complete</code> and <code class="code">compgen</code> builtins
to do much of the work, adding only the things that the Bash <code class="code">cd</code>
does beyond accepting basic directory names:
tilde expansion (see <a class="pxref" href="Tilde-Expansion.html">Tilde Expansion</a>),
searching directories in <var class="var">$CDPATH</var>, which is described above
(see <a class="pxref" href="Bourne-Shell-Builtins.html">Bourne Shell Builtins</a>),
and basic support for the <code class="code">cdable_vars</code> shell option
(see <a class="pxref" href="The-Shopt-Builtin.html">The Shopt Builtin</a>).
<code class="code">_comp_cd</code> modifies the value of <var class="var">IFS</var> so that it contains only
a newline to accommodate file names containing spaces and tabs &ndash;
<code class="code">compgen</code> prints the possible completions it generates one per line.
</p>
<p>Possible completions go into the <var class="var">COMPREPLY</var> array variable, one
completion per array element.
The programmable completion system retrieves
the completions from there when the function returns.
</p>
<div class="example">
<pre class="example-preformatted"># A completion function for the cd builtin
# based on the cd completion function from the bash_completion package
_comp_cd()
{
    local IFS=$' \t\n'    # normalize IFS
    local cur _skipdot _cdpath
    local i j k

    # Tilde expansion, which also expands tilde to full pathname
    case &quot;$2&quot; in
    \~*)    eval cur=&quot;$2&quot; ;;
    *)      cur=$2 ;;
    esac

    # no cdpath or absolute pathname -- straight directory completion
    if [[ -z &quot;${CDPATH:-}&quot; ]] || [[ &quot;$cur&quot; == @(./*|../*|/*) ]]; then
        # compgen prints paths one per line; could also use while loop
        IFS=$'\n'
        COMPREPLY=( $(compgen -d -- &quot;$cur&quot;) )
        IFS=$' \t\n'
    # CDPATH+directories in the current directory if not in CDPATH
    else
        IFS=$'\n'
        _skipdot=false
        # preprocess CDPATH to convert null directory names to .
        _cdpath=${CDPATH/#:/.:}
        _cdpath=${_cdpath//::/:.:}
        _cdpath=${_cdpath/%:/:.}
        for i in ${_cdpath//:/$'\n'}; do
            if [[ $i -ef . ]]; then _skipdot=true; fi
            k=&quot;${#COMPREPLY[@]}&quot;
            for j in $( compgen -d -- &quot;$i/$cur&quot; ); do
                COMPREPLY[k++]=${j#$i/}        # cut off directory
            done
        done
        $_skipdot || COMPREPLY+=( $(compgen -d -- &quot;$cur&quot;) )
        IFS=$' \t\n'
    fi

    # variable names if appropriate shell option set and no completions
    if shopt -q cdable_vars &amp;&amp; [[ ${#COMPREPLY[@]} -eq 0 ]]; then
        COMPREPLY=( $(compgen -v -- &quot;$cur&quot;) )
    fi

    return 0
}
</pre></div>

<p>We install the completion function using the <samp class="option">-F</samp> option to
<code class="code">complete</code>:
</p>
<div class="example">
<pre class="example-preformatted"># Tell readline to quote appropriate and append slashes to directories;
# use the bash default completion for other arguments
complete -o filenames -o nospace -o bashdefault -F _comp_cd cd
</pre></div>

<p>Since we&rsquo;d like Bash and Readline to take care of some
of the other details for us, we use several other options to tell Bash
and Readline what to do.
The <samp class="option">-o filenames</samp> option tells Readline
that the possible completions should be treated as filenames, and quoted
appropriately.
That option will also cause Readline to append a slash to
filenames it can determine are directories (which is why we might want to
extend <code class="code">_comp_cd</code> to append a slash if we&rsquo;re using directories found
via <var class="var">CDPATH</var>: Readline can&rsquo;t tell those completions are directories).
The <samp class="option">-o nospace</samp> option tells Readline to not append a space
character to the directory name, in case we want to append to it.
The <samp class="option">-o bashdefault</samp> option brings in the rest of the &ldquo;Bash default&rdquo;
completions &ndash; possible completions that Bash adds to the default Readline
set.
These include things like command name completion, variable completion
for words beginning with &lsquo;<samp class="samp">$</samp>&rsquo; or &lsquo;<samp class="samp">${</samp>&rsquo;, completions containing
pathname expansion patterns (see <a class="pxref" href="Filename-Expansion.html">Filename Expansion</a>), and so on.
</p>
<p>Once installed using <code class="code">complete</code>, <code class="code">_comp_cd</code> will be called every
time we attempt word completion for a <code class="code">cd</code> command.
</p>
<p>Many more examples &ndash; an extensive collection of completions for most of
the common GNU, Unix, and Linux commands &ndash; are available as part of the
bash_completion project.  This is installed by default on many GNU/Linux
distributions.  Originally written by Ian Macdonald, the project now lives
at <a class="url" href="https://github.com/scop/bash-completion/">https://github.com/scop/bash-completion/</a>.
There are ports for other systems such as Solaris and Mac OS X.
</p>
<p>An older version of the bash_completion package is distributed with bash
in the <samp class="file">examples/complete</samp> subdirectory.
</p>
<a class="index-entry-id" id="index-History_002c-how-to-use"></a>

</div>
<hr>
<div class="nav-panel">
<p>
Previous: <a href="Programmable-Completion-Builtins.html">Programmable Completion Builtins</a>, Up: <a href="Command-Line-Editing.html">Command Line Editing</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Indexes.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
